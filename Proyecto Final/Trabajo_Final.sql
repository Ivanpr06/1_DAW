--SCRIPT PARA INSERTAR FILAS EN LA TABLA ARTICULOS
INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Insalata César', 'Lechuga, pollo frito, picatostes, escamas de partisano y nuestra salsa César', 12, 'ENTRANTES', 
'Lava y corta la lechuga en trozos. Para la salsa César, haz una mayonesa poniendo en la jarra el huevo, el ajo, la sal, 
el vinagre y el aceite y bate con la batidora de brazo apoyada en el fondo. Cuando veas que está ligada, levanta poco a poco 
hasta emulsionar todo el aceite. Añade las anchoas, el queso parmesano rallado, la mostaza y la pimienta. Bate de nuevo hasta 
triturar todo y obtener una textura homogénea.', 'https://www.annarecetasfaciles.com/files/ensalada-cesar-1-1-1024x575.jpg', 20, 
TO_TIMESTAMP('2025-05-14 16:14:30.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 16:14:30.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);

INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Insalata Capresse', 'Rodajas de tomate, aceite de oliva virgen, flor de sal, albahaca y reducción de balsámico', 11, 'ENTRANTES', 
'Lavamos bien el tomate y la albahaca y los secamos con papel de cocina. Secamos también la bola de mozzarella para facilitarnos la labor de cortarla en rodajas.
Por su parte, a las hojas de albahaca, les retiramos el tallo para que en la ensalada, esté la parte más sabrosa solamente. Cortamos el tomate en rodajas finas.', 
'https://i.blogs.es/2d572b/caprese/1366_2000.jpg', 10, 
TO_TIMESTAMP('2025-05-14 16:25:34.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 16:25:34.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);

INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Tagliatelle funghi e tartufo', 'Tagliatelle con crema de champiñon y salsa de trufa', 16, 'COMIDA', 
'Pon a cocer la pasta en una olla con abundante agua hirviendo y sal.Mientras se cuece la pasta, lava los champiñones y lamínalos.
En una sartén, pon a fundir la mantequilla con un poco de aceite de oliva. Una vez fundida la mantequilla, añade el ajo picado y sofríelo. 
Cuando el ajo comience a dorarse, incorpora los champiñones laminados y continúa rehogando. Ahora añade el parmesano rallado y la nata. 
Salpimenta y deja cocinar a fuego suave hasta que la salsa adquiera mayor consistencia.', 
'https://cdn.recetasderechupete.com/wp-content/uploads/2023/10/Tagliatelle-al-funghi-portada.jpg', 30, 
TO_TIMESTAMP('2025-05-14 16:34:37.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 16:34:37.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);

INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Ravioli pecorino e pere', 'Raviolis de queso pecorino y peras con salsa de mantequilla, tomillo y nueces', 17, 'COMIDA', 
'Comenzamos preparando la masa de los raviolis. En un bol ponemos la harina tamizada, una cucharada de aceite de oliva y los huevos. 
Mezclamos bien con las manos hasta que la harina absorba toda la humedad del huevo y después, amasamos hasta conseguir una masa homogénea.
Cortamos un trozo de la masa y la estiramos hasta conseguir una lámina fina. Le ponemos un poco de harina y la dejamos reposar 15 minutos mientras preparamos el relleno.', 
'https://canalcocina.es/medias/_cache/zoom-d611a17a649aa1639e8c3a0e042ac08d-920-518.jpg', 35, 
TO_TIMESTAMP('2025-05-14 16:36:42.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 16:36:42.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);


INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Cotto e Funghi', 'Tomate, fiordilatte, jamón york y champiñones', 14, 'COMIDA', 
'Diluye la levadura de cerveza en un chorrito de agua tibia y espera unos 20 minutos para que se active. 
Entonces, agrega la harina y mezcla bien con las manos, añadiendo más agua tibia si fuera necesario. Agrega la sal a la masa. 
Lleva la masa a una superficie limpia y amasa durante al menos 20 minutos. Al final, pon un par de cucharadas de aceite de oliva 
virgen extra y haz una bola.', 
'https://lamafia.es/wp-content/uploads/2016/10/pizza-prosciutto-e-funghi-la-mafia2.png', 45, 
TO_TIMESTAMP('2025-05-14 16:38:12.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 16:38:12.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);

INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Formaggi', 'Tomate, mozzarella fiordilatte, queso gorgonzola, queso parevano, queso parevano y queso cheddar', 12, 'COMIDA', 
'Prepara la masa de la pizza. Precalienta el horno a 250ºC con calor arriba y abajo. Reparte los quesos elegidos sobre la base.
Primeramente, espolvorea el queso parmesano rallado. Añade trozos de los diferentes quesos. Repártelos de forma estratégica por toda la superficie.', 
'https://valledearas.com/wordpress/wp-content/uploads/2023/01/pizza-4-quesos.jpg', 40, 
TO_TIMESTAMP('2025-05-14 16:40:25.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 16:40:25.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);


INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Coca-cola', 'Bebida gaseosa refrescante', 2, 'BEBIDA', 'Sin receta', 
'https://elfornet.com/media/catalog/product/cache/728587fcd73f36684dd4a1c3c4b36cfb/c/o/coca-cola-lata-33cl-caja-24unid_1_1_1.jpeg', 0, 
TO_TIMESTAMP('2025-05-14 17:32:25.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 17:32:25.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);

INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Nestea', 'Bebida refrescante de limón', 2, 'BEBIDA', 'Sin receta', 
'https://www.dragonoriental.com/972-large_default/nestea-330-ml.jpg', 0, 
TO_TIMESTAMP('2025-05-14 17:39:45.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 17:39:45.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);

INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Agua', 'Mineral', 2, 'BEBIDA', 'Sin receta', 
'https://www.pmc.es/articulo/botella-agua-font-vella-0-5-litros--pack-24-', 0, 
TO_TIMESTAMP('2025-05-14 17:41:16.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 17:41:16.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);

INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Tiramisú', 'Típico postre italiano a base de bizcochos de soletilla, cacao, mascarpone y café.', 8, 'POSTRES', 
'En primer lugar, separamos las claras y las yemas de 2 huevos M. Reservamos las yemas. Montamos las claras a punto de nieve hasta que estén bien firmes y las reservamos. 
Batimos las yemas que habíamos reservado con 50 gramos de azúcar, hasta que hayan blanqueado y doblado su volumen, reservamos.
Ponemos 250 gramos de queso mascarpone en un bol y lo ablandamos un poco con la ayuda de una espátula o una cuchara.', 
'https://ocagiuliva.es/wp-content/uploads/2023/03/oca-marzo-2019-072.jpg', 50, 
TO_TIMESTAMP('2025-05-14 17:43:28.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 17:43:28.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);

INSERT INTO C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA (
NOMBRE, DESCRIPCION, PRECIO, CATEGORIA, RECETA, IMAGEN_URL, TIEMPO_PREPARACION, FECHA_CREACION, FECHA_MODIFICACION
)
VALUES (
'Bocconotti', 'Se trata de un dulce italiano típico de la tradición de Abruzzo , Molisana , Salentine , Lucana , Puglia y Calabrese que difieren entre ellos 
y se caracterizan por un relleno que varia según la zona donde se elaboren.', 9, 'POSTRES', 'En un bol, añadimos los huevos junto con el azúcar, el aceite, el licor y 
la vainilla. Mezclamos con ayuda del batidor a velocidad media durante un par de minutos. Comenzamos a añadir la harina, lo haremos poco a poco y mezclando, con ayuda de la pala, durante unos segundos. Lo justo para integrar bien todos los ingredientes.', 
'https://bsstatic2.mrjack.es/wp-content/uploads/2021/02/bocconotti.jpg', 16, 
TO_TIMESTAMP('2025-05-14 17:49:08.000000', 'YYYY-MM-DD HH24:MI:SS.FF6'),
TO_TIMESTAMP('2025-05-14 17:49:08.000000', 'YYYY-MM-DD HH24:MI:SS.FF6')
);

--TRIGGER PARA CREACIÓN DE COLUMNAS "FECHA_CREACIÓN" Y "FECHA_MODIFICACIÓN"--
CREATE OR REPLACE TRIGGER usuario
BEFORE INSERT OR UPDATE ON C##RAMOS.RISTORANTERAMOS_USUARIO 
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        IF :NEW.fecha_creacion IS NULL THEN
            :NEW.fecha_creacion := SYSDATE;
        END IF;
        :NEW.fecha_modificacion := SYSDATE;
    ELSIF UPDATING THEN
        :NEW.fecha_modificacion := SYSDATE;
    END IF;
END;

--CREO UNA TABLA PARA RECOGER EL RESULTADO DEL PROCEDURE--
CREATE TABLE C##RAMOS.TOP_ARTICULOS_RESULTADO(
    nombre_articulo VARCHAR2(255),
    cantidad_vendida NUMBER
);

--PROCEDURE: TOP 5 ARTICULOS MÁS VENDIDOS--
CREATE OR REPLACE PROCEDURE top_5_articulos_mas_vendidos
IS
BEGIN
    DELETE FROM C##RAMOS.TOP_ARTICULOS_RESULTADO;
    
    INSERT INTO C##RAMOS.TOP_ARTICULOS_RESULTADO (nombre_articulo, cantidad_vendida)
    SELECT ac.nombre, SUM(lp.cantidad)
    FROM C##RAMOS.RISTORANTERAMOS_LINEAPEDIDO lp
    JOIN C##RAMOS.RISTORANTERAMOS_ARTICULOCARTA ac ON lp.articulo_id = ac.id
    GROUP BY ac.nombre
    ORDER BY SUM(lp.cantidad) DESC
    FETCH FIRST 5 ROWS ONLY;
END;

INSERT INTO RISTORANTERAMOS_MESA (ESTADO, FECHA_CREACION, FECHA_MODIFICACION)
VALUES (
'Libre', SYSDATE, SYSDATE
);